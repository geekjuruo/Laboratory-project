### ABSTRACT

用于分类IP流量的抽象机器学习（ML）依赖于仅对全流量或其前几个分组的统计分析。但是，交互式流量的自动QoS管理需要在流程完成之前快速，及时地进行分类。此外，互动流程通常是长寿的，应在其生命周期内持续监控。我们建议通过使用从子流派生的统计数据来实现这一点 - 从流的生命周期中的任何点获取的少量最新数据包。然后，必须在一组子流上训练ML分类器，并且我们研究不同的子流选择策略。我们还建议增加训练数据集，以便即使分类器混合了客户端到服务器和服务器到客户端的方向，以便显示不对称流量特征的应用程序，也能保持分类准确性。我们使用朴素贝叶斯和C4.5决策树ML算法证明了我们的方法的有效性，用于识别第一人称射击游戏和VoIP流量。我们的结果表明，我们可以在不到1秒的时间内对两种应用进行分类，精度高达99％，召回率高达95％。无论分类器在何处捕获分组和业务方向，都可以获得稳定的结果。

### INTRODUCTION

自20世纪90年代初以来，为支持QoS的互联网寻找可行的解决方案已经吸引了大量的研究工作。 许多QoS方案的关键组成部分是提供和管理健壮，自动化和实时的IP流量分类（IPTC）。 IPTC可以作为自动启用QoS的互联网的核心部分，通过快速自动识别感兴趣的流量（无需人为干预）来协助QoS信令流程，并触发自动QoS控制系统来分配网络资源 优先申请[1]。 它还有可能支持基于类的QoS计费和计费，协助自动入侵检测[2]，并在合法拦截中发挥重要作用[3]。通常部署的IPTC涉及检查数据包的内容或TCP / UDP端口号。 然而，这种技术的有效性正在减弱。需要定期更新以跟踪应用程序的数据包有效负载格式的微小变化，应用程序通过加密来混淆数据包内容，并且政府隐私法规可能会限制第三方合法检查有效负载的能力。研究界根据外部可观察到的交通属性的统计模式，特别是机器学习（ML）技术的应用，对IPTC做出了回应。流的属性（例如分组长度或分组间隔时间）被称为特征。分类涉及两个阶段 - 训练ML算法以将特征集与已知的流量类（创建“规则”）相关联，并应用这些规则来对未知流量进行分类。

大多数已发表的研究都集中在不同ML算法在全流程上进行训练和测试时的效果，在长流量交互流程的情况下，这些算法有数千个数据包。然而，在具有自动QoS控制的真实网络中，IPTC必须快速做出决策（在流程停止之前）。一些较新的工作仅使用前几个流数据包来调查分类。但是，例如，恶意攻击可能会在其流程的生命周期早期用可信应用程序的统计属性伪装自己，这是不够的。或者，分类器本身可能已经启动（或重新启动），而数百或数千个流已经通过网络监控点处于活动状态（从而错过了这些活动流的启动）。因此，理想情况下，每个流程应在其整个生命周期内正确且连续地分类。

先前工作未解决的另一个问题是方向性是特征的隐含属性。 通常，应用程序流被定义为双向的，并且用于训练的特征在前向和反向方向上分别计算（通常由流的第一分组指示的前向方向通常是客户端到服务器）。 如果在后续操作期间分类器始终看到每个流的第一个数据包并使用正确的方向感计算特征，则此方法很有效。 但是，由于数据包采样，高负载或错过的流启动（例如分类器启动或重新启动而长期交互流已在进行中），真实世界的分类器可能看不到第一个数据包。 因为，对于许多应用，流量特性在两个方向上都是不对称的，这可能导致分类精度降低。

我们提出并评估对传统ML技术的新颖修改，这些技术可优化长期交互流的及时和连续分类，并可部署在物理资源有限的运营IP网络中。

我们建议在每个流程上使用滑动窗口操作ML分类器; 分类器在任何给定时间使用不超过N个连续流的数据包，称为子流。 使用在原始应用流程的生命周期内的不同点处的多个子流计算的多组特征来训练ML分类器。 对多个子流的培训允许分类器在流的生命周期的任何点快速识别应用程序。 通常，基于在分类器的实现中对流或存储器限制进行分类所允许的时间的上限来选择。

为了克服方向性问题，我们建议通过合成具有交换的前向和后向特征的每个子流的互补版本来增强训练数据集，称为“合成子流对”（SSP）。然后，由分类器捕获的流的第一个分组可以表示客户端到服务器（C-S）或服务器到客户端（S-C）流量。 SSP训练分类器以任一方式识别应用程序。
最后，为了训练分类器，我们可以自动选择有限数量的代表性子流，以最好地捕获全流的统计变化。除了手动选择的子流和简单的随机采样，我们还使用无监督的聚类ML技术来自动化选择过程，称为“聚类技术的辅助”（ACT）。
我们通过两种不同类型的网络延迟不容忍应用证明了我们提出的方法的有效性，这些应用可以从支持QoS的网络中获益：第一人称射击（FPS）游戏（Wolfenstein：Enemy Territory，或ET [ 4]）和VoIP流量（G.711和GSM编解码器）。 ET的流量特性可以在流的寿命期间改变，并且在C-S和S-C方向上是不对称的。 VoIP流量更稳定，更对称。我们的结果显示，使用25个数据包的子流，两个应用程序的精度达到99％，回收率达到95％。无论分类器在何处捕获分组和业务方向，都可以获得稳定的结果。最近发表的作品表明，我们提出的方法也适用于Skype [5]和BitTorrent流量[6]，证实它有利于识别其他应用流量。
我们提案的核心要素（多个子流程，SSP和ACT的培训）分别在[7]  -  [9]中首次阐述。本文现在整合并大大扩展了我们以前的工作。除了FPS游戏，我们不仅要分析另一个应用类别;我们还提供了更详细的分析，包括两种不同的ML算法。对于两者，我们在分类准确性和及时性方面表现出明显的改进，这表明我们的方法适用于不同的ML算法。我们还对数据包丢失对两种应用的分类准确性的影响进行了初步调查。最后，我们分析了我们的方法的实际实现的性能，该方法适用于基于PC的路由器，网桥或被动监视器（称为DIFFUSE）[10]。
我们的论文的结构安排如下。第二部分重点介绍了重要的相关工作和未解决的问题。第三节介绍了我们提出的方法。第四节描述了我们的实验方法，我们的结果在第五节中进行了分析。第六节分析了数据包丢失的影响。第七节介绍了使用DIFFUSE取得的成果。在我们总结并概述第IX节中的未来工作之前，第VIII节讨论了我们的发现。

### RELATED WORK AND PROBLEM STATEMENT

ML技术在IPTC中的应用在过去几年中引起了极大的关注。麦格雷戈等人。 [11]使用期望最大化（EM）算法在IPTC中应用ML。该方法将具有类似可观察属性的流量聚类到不同的应用程序类型中。发现该算法将流量分成少量基本类。 Roughan等人。 [12]使用最近邻和线性/二次判别分析ML算法将不同的网络应用映射到预定的QoS流量类。 Zander等人。 [13]使用AutoClass，一种无监督的贝叶斯分类器，从训练数据中确定最佳的集群集。他们研究了一系列应用，并表明它们之间可以实现一些分离。
Moore和Zuev [14]提出应用监督的朴素贝叶斯技术通过应用对互联网流量进行分类。在[15]中应用贝叶斯神经网络方法扩展了这项工作。 Bernaille等。 [16]使用Simple K-Means使用前几个流量包分类不同类型的基于TCP的应用程序。继早期交通分类的路径相同，Sena和Belzarena [17]和Li等人。 [18]研究了在流的两个方向上使用第一个数据包的统计特性作为特征。 Li和Moore分析了基于ML的分类系统的理论复杂性[19]。 Park等。 [20]提出使用基于遗传算法的特征选择技术。
Erman等人。 [21]解决了网络核心的流量分类挑战，其中有关流量及其贡献者的可用信息可能有限。他们在[22]和Rotsos等人的工作。 [23]研究了半监督的交通分类方法，它结合了非监督和监督方法。 Teja等人。 [24]使用ML方法的组合研究了网络流量的分类。 Crotti等人。 [25]提出了一种优化机制，允许调整许多分类参数，以根据环境优化分类器的性能。在IPTC中比较和评估不同ML算法的许多其他工作包括[26]  -  [30]。 Palmieri和Fiore [31]指出了流量统计特性随时间的非平稳性，并提出在流量分类的时间序列中使用递归现象和隐藏的非平稳过渡模式。
由于篇幅限制，我们无法在此列出所有相关工作。使用ML的更全面的互联网流量分类调查可以在[32]和[33]中找到。
大多数已发表的研究评估了不同ML算法在受到数千个数据包组成的全流程训练和分类时的有效性。 ML分类器的功效尚未被探索，因为它们只能访问流的数据包的子集，或者它们没有看到每个流的开始（即使最近的工作在[16]  -  [18]中假设流的初始数据包）可用于分类）。
假设应用程序流是双向的，并且应用程序的统计特征在正向和反向分别计算（例如，[11]，[13]，[14]，[16]  -  [18]，[30]和[31]）。这可能会导致先前讨论的方向性问题。在实际网络中，流量分类器可能看不到流的实际开始并且不知道客户端或服务器实际位于何处，因此他们无法确定他们看到的第一个数据包（任何新的双向流）的方向正在前进。这可能导致分类性能下降。

### PROPOSED APPROACH

为了实现及时和连续的流量识别，我们建议在最近的双向流包（对于一些小的值）的小滑动窗口上进行分类。我们定义为滑动窗口的步长。我们将子流定义为从流的包号开始的流的包的窗口（参见图1）。从位置开始的子流称为SF-M。
选择是在时效性（越小，初始分类越快）和准确性（越大，准确性越好）之间进行权衡。选择确定所需的重分类频率和资源（越小，我们重新分类越频繁，因此可能需要更多的CPU /内存）。
与全流分析相比，我们的子流方法还可以帮助减少内存需求，特别是在分类器可能正在观察（数十）数千个并发流的高速网络上。在完整流程上计算功能通常可能需要内存复杂性（其中
虽然可以仅使用内存复杂度来计算某些特性，但它是流的数据包总数。通过子流计算的特征具有最多的存储器复杂性，并且最多也仅需要存储器复杂性（尽管这可能需要不重叠的窗口，即，）。
以下步骤描述了如何识别子流以进行培训/操作并选择用于培训。

#### A step Sub-Flow Identification

该步骤识别所有可能的子流以训练分类器或在操作期间。 可以如下实现子流的自动识别。

* 选择窗口大小和步长分数 S($e.g.\frac{N}{2}$)
* 从流的第一个数据包开始，以数据包的步长滑过数据包，每个数据包创建连续数据包的子流。

#### B step Sub-Flow Selection

使用步骤1中识别的所有子流训练分类器可能需要太多的处理开销。 子流选择减少了分类器在训练和实际操作期间的负荷（较小的训练数据集和较简单的分类模型）。 它仅选择有限数量的代表性子流进行培训。 理想情况下，这些子流最能捕捉整个流程在其生命周期中的独特统计变化。

该步骤可以基于熟知的交通统计特性的专业知识手动完成。 例如，ET的初始游戏设置与游戏期间的流量看起来非常不同，因此可以在流的开始和中间获取子流。 但是，对于新应用程序，此步骤应自动完成。
在本文的前面部分，我们描述了一种通过使用聚类ML技术来自动执行此步骤的方法。 无监督聚类算法识别来自步骤1的初始子流集合中的“自然”聚类。聚类包含具有相似统计特征的不同子流的成员。 从每个群集中，代表性成员可用于训练分类器，而不是使用整个群集的群体。 第七节中描述的DIFFUSE表明，分层随机子流选择也表现出良好的结果。

#### C step Synthetic Sub-Flow Pairs

在步骤2中选择的每个子流导致从子流的分组导出的一组特征值（正向被识别为C-S或S-C）。使用ET作为感兴趣的应用，图2中示出了特征计算（F），训练（T）和分类（C）的关键步骤。然后在训练ML分类器之前将每个子流的实例标记为ET或其他类。培训的输出是用于识别ET和其他流量的分类规则。
对于SSP，通过将特征值从前向交换到后向，在称为F的单独步骤中创建每个子流实例的合成互补版本（称为镜像复制），反之亦然。图3示出了用于子流实例X的该过程。将LF和LB视为X的平均前向和后向分组长度（分别）。 X的镜像复制品分别分配LB和LF的平均前向和后向分组长度。对于X的其他特征，重复相同的镜像。

培训和分类有两种选择。
1）子流实例及其镜像副本被标记为相同的类。 例如，ET实例及其镜像副本都标记为ET类。 这对分类器进行训练，使得具有类似于ET或其镜像的交通特征的新流量 - 
图像副本将被归类为ET流量。
2）或者，子流实例及其镜像副本被标记为两个单独的类。 例如，ET实例被标记为ET类，并且它们的mirror-imagereplicasarelala标记为ET类。这个执行器分别用于标识ET，ET，Other和其他类。然后，将更新分类为新的流程将是被归类为ET流量。

这两种方法都显着改善了分类器的性能
与一个明确的流向定义的训练相比。 对于我们的数据集，选项2提供略微更好的整体准确性（Naive Bayes的改进大于C4.5），但计算性能较低（模型构建时间较长，分类速度较慢）。 考虑到整体准确性和计算性能，我们选择使用本文中的选项1。
注意，当分类器知道服务器时，SSP的替代方案是使用该知识将分组分组成流（即，无论分组的方向如何，服务器IP总是成为流表中的目的地IP地址）。 但是，在实践中，通常可能不知道服务器。 此外，这种方法还需要在每次服务器更新发生时更新分类器。

### EXPERIMENTAL APPROACH

#### A. Machine Learning Algorithms



#### B. Flows and Features



#### C. Applications



#### D. Other Traffic



#### E. Construction of Training and Testing Datasets



### RESULTS AND ANALYSIS

A. Classification of ET Traffic

B. Classification of VoIP Traffic

### CLASSIFICATION ACCURACY WITH PACKET LOSS

### EVALUATION OF REAL-WORLD IMPLEMENTATION

### DISCUSSION

### CONCLUSION AND FUTURE WORK

